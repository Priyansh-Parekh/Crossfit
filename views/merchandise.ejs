

<% if (user!=='none') { %>
    
<main class="merch-container">
    <!-- 1. Page Header Section -->
    <div class="merch-header">
        <h1 class="merch-header__title">Official Club Merchandise</h1>
        <p class="merch-header__subtitle">Find the latest gear and support your team</p>
    </div>

    <!-- 2. Filter Controls Section -->
    <div class="merch-filters">
        <button class="merch-filter-btn active" data-category="all">
            <i class="fas fa-boxes-stacked"></i> All
        </button>
        <button class="merch-filter-btn" data-category="Jersey">
            <i class="fas fa-tshirt"></i> Jerseys
        </button>
        <button class="merch-filter-btn" data-category="Apparel">
            <i class="fas fa-hat-wizard"></i> Apparel
        </button>
        <button class="merch-filter-btn" data-category="Accessories">
            <i class="fas fa-star"></i> Accessories
        </button>
        <button class="merch-filter-btn" data-category="Equipment">
            <i class="fas fa-futbol"></i> Equipment
        </button>
    </div>

    <!-- 3. Product Grid -->
    <div class="merch-grid">
        <% if (merchandise && merchandise.length > 0) { %>
            <% merchandise.forEach(product => { %>
                <!-- The data-category attribute is essential for filtering -->
                <div class="merch-card" data-category="<%= product.category %>">
                    <div class="merch-card__image-wrapper">
                        <img src="<%= product.imageUrl || '/img/default_product.png' %>" class="merch-card__image" alt="<%= product.name %>">
                        
                        <!-- Stock Status Badge -->
                        <% if (product.stock_quantity === 0) { %>
                            <span class="merch-card__badge out-of-stock">Out of Stock</span>
                        <% } else if (product.stock_quantity < 10) { %>
                            <span class="merch-card__badge low-stock">Low Stock</span>
                        <% } %>
                    </div>
                    <div class="merch-card__body">
                        <span class="merch-card__category"><%= product.category %></span>
                        <h5 class="merch-card__title"><%= product.name %></h5>
                        <p class="merch-card__description"><%= product.description.substring(0, 80) %>...</p>
                    </div>
                    <div class="merch-card__footer">
                        <strong class="merch-card__price">â‚¹<%= product.price.toFixed(2) %></strong>
                        
                        <% if (user) { %>
                            <!-- Disable button if out of stock -->
                            <button
                                class="btn btn-primary add-to-cart-btn" 
                                data-id="<%= product._id %>"
                                <%= product.stock_quantity === 0 ? 'disabled' : '' %>>
                                <i class="fas fa-shopping-cart"></i> 
                                <%= product.stock_quantity === 0 ? 'Unavailable' : 'Add to Cart' %>
                            </button>
                        <% } else { %>
                            <a href="/login" class="btn btn-secondary">Login to Buy</a>
                        <% } %>
                    </div>
                </div>
            <% }); %>
        <% } else { %>
            <div class="merch-empty-state">
                <i class="fas fa-store-slash"></i>
                <h2>Store Is Empty</h2>
                <p>No products are available right now. Please check back later!</p>
            </div>
        <% } %>
        
        <!-- Message to show if no products match the filter -->
        <div class="merch-no-results" style="display: none;">
            <i class="fas fa-search-minus"></i>
            <h2>No Matches Found</h2>
            <p>No products match the selected category.</p>
        </div>
    </div>
</main>
 <% } else { %>
    <div class="live-score-page-no-login">
        <h1>Please log in to view Merchandise</h1>
        <p>You need to be logged in to access Merchandise.</p>
        <a href="/#home-roles" class="live-score-page-login-btn">Login</a>
    </div>
<% } %>


